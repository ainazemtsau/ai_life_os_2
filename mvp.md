AI Workspace MVP — План реализации
Общее описание
Цель: Создать proof-of-concept где пользователь общается с AI, AI создаёт структуры данных и управляет ими, пользователь видит результат в реальном времени.
Архитектура:

Pocketbase — хранение данных + REST API
Backend (FastAPI) — AI логика + WebSocket для чата
Mem0 — долгосрочная память AI
Frontend (React) — чат + отображение данных

Ключевой принцип: Один WebSocket от Frontend к Backend. Backend отправляет все события (ответы AI, изменения данных).

Этапы
ЭтапНазваниеСрокРезультат0Инфраструктура1 деньDocker окружение запускается1Pocketbase setup0.5 дняСистемные коллекции созданы2Backend core1-2 дняWebSocket работает, можно отправлять/получать сообщения3Mem0 интеграция1 деньПамять сохраняется между сессиями4AI Agent2-3 дняAI может создавать коллекции и записи5Frontend2 дняChat + список entities с realtime6Интеграция1-2 дняE2E сценарий работает
Общий срок: ~8-12 дней

Этап 0: Инфраструктура
Что сделать
Подготовить Docker окружение со всеми сервисами. Убедиться что всё запускается и сервисы видят друг друга.
Задачи
0.1 Создать структуру папок проекта
0.2 Написать docker-compose.yml с сервисами:
    - pocketbase
    - redis
    - backend (пока заглушка)
    - frontend (пока заглушка)
0.3 Создать .env.example с переменными окружения
0.4 Создать базовые Dockerfile для backend и frontend
0.5 Запустить и проверить что всё стартует
Критерии завершения

 docker-compose up запускает все 4 сервиса без ошибок
 Pocketbase админка доступна: http://localhost:8090/_/
 Redis отвечает: docker-compose exec redis redis-cli ping → PONG
 Backend отвечает: http://localhost:8000/health → {"status": "ok"}
 Frontend открывается: http://localhost:3000 → видна заглушка


Этап 1: Pocketbase Setup
Что сделать
Создать системные коллекции в Pocketbase через админку. Это фиксированные структуры которые нужны приложению.
Задачи
1.1 Создать admin аккаунт в Pocketbase
1.2 Создать коллекцию "agents" (AI агенты)
1.3 Создать коллекцию "conversations" (активные разговоры)
1.4 Создать дефолтного агента-координатора
1.5 Настроить API rules (разрешить доступ)
1.6 Экспортировать схему для воспроизводимости
Критерии завершения

 В Pocketbase есть коллекция agents с полями: name, type, system_prompt, config, is_active
 В Pocketbase есть коллекция conversations с полями: status, context
 Существует запись агента "Coordinator" в коллекции agents
 API доступен: GET http://localhost:8090/api/collections/agents/records возвращает агента
 Есть файл/документация для воспроизведения схемы на чистом Pocketbase


Этап 2: Backend Core
Что сделать
Создать FastAPI приложение с WebSocket эндпоинтом. Пока без AI — просто echo сервер для проверки связи.
Задачи
2.1 Настроить FastAPI проект со структурой папок
2.2 Добавить конфигурацию из environment переменных
2.3 Создать health check эндпоинт
2.4 Создать WebSocket эндпоинт /chat
2.5 Реализовать базовый протокол сообщений (JSON)
2.6 Добавить connection manager для WebSocket
2.7 Создать клиент для Pocketbase API
2.8 Проверить что backend может читать данные из Pocketbase
Критерии завершения

 GET /health возвращает {"status": "ok"}
 WebSocket подключение к ws://localhost:8000/chat устанавливается
 Отправка {"type": "message", "content": "hello"} возвращает echo {"type": "echo", "content": "hello"}
 Backend может получить список agents из Pocketbase (лог в консоли)
 При ошибке соединения — понятное сообщение об ошибке


Этап 3: Mem0 Интеграция
Что сделать
Подключить Mem0 для долгосрочной памяти AI. Проверить что память сохраняется между перезапусками.
Задачи
3.1 Добавить mem0ai в зависимости
3.2 Настроить Mem0 с Redis как storage backend
3.3 Создать MemoryService с методами:
    - add_memory(user_id, messages)
    - search_memories(user_id, query) 
3.4 Написать тест сохранения и поиска
3.5 Проверить персистентность после рестарта
Критерии завершения

 Mem0 инициализируется без ошибок при старте backend
 Вызов add_memory("user1", [...]) не падает
 Вызов search_memories("user1", "test query") возвращает результат (может быть пустой)
 После docker-compose restart backend — ранее сохранённые memories находятся
 Лог показывает успешное подключение к Redis


Этап 4: AI Agent
Что сделать
Создать AI агента с PydanticAI который может создавать коллекции и записи в Pocketbase. Интегрировать с WebSocket.
Задачи
4.1 Добавить pydantic-ai в зависимости
4.2 Настроить подключение к LLM (Anthropic/OpenAI/Ollama)
4.3 Определить структуру контекста для агента (AgentContext)
4.4 Создать tools:
    - list_collections — список существующих коллекций
    - create_collection — создать новую коллекцию
    - list_records — список записей в коллекции
    - create_record — создать запись
    - update_record — обновить запись
    - delete_record — удалить запись
4.5 Написать system prompt для агента
4.6 Создать ConversationService:
    - загрузка контекста (коллекции, последние записи, memories)
    - вызов агента
    - сохранение в память
4.7 Интегрировать с WebSocket:
    - получение сообщения → вызов AI → отправка ответа
    - при выполнении tool → отправка события (entity_created и т.д.)
4.8 Протестировать базовые сценарии вручную
Критерии завершения

 Отправка "привет" через WebSocket → получение осмысленного ответа от AI
 Отправка "создай тип для задач" → AI создаёт коллекцию в Pocketbase (видно в админке)
 Отправка "добавь задачу: тест" → AI создаёт запись (видно в админке)
 Отправка "покажи все задачи" → AI отвечает со списком
 При создании записи приходит WebSocket событие {"type": "entity_created", ...}
 При создании коллекции приходит событие {"type": "collection_created", ...}
 После рестарта backend: "что тут есть?" → AI отвечает на основе памяти


Этап 5: Frontend
Что сделать
Создать минимальный React интерфейс с чатом и списком entities. Подключить к WebSocket backend.
Задачи
5.1 Настроить React + TypeScript + Vite проект
5.2 Добавить TailwindCSS для стилей
5.3 Создать layout: sidebar (entities) + main (chat)
5.4 Создать WebSocket hook (useWorkspace):
    - подключение к backend
    - отправка сообщений
    - обработка событий (ai_response, entity_created, и т.д.)
    - хранение состояния (messages, collections)
5.5 Создать Chat компонент:
    - список сообщений
    - поле ввода
    - индикатор "AI думает"
5.6 Создать EntityList компонент:
    - группировка по коллекциям
    - отображение записей
    - автообновление при событиях
5.7 Загрузка начальных данных при старте (существующие коллекции и записи)
5.8 Обработка ошибок и состояний загрузки
Критерии завершения

 Приложение открывается на http://localhost:3000
 Можно написать сообщение и отправить
 Ответ AI появляется в чате
 Пока AI "думает" — виден индикатор
 При создании entity через AI — она появляется в sidebar без перезагрузки
 При обновлении entity — изменения видны в sidebar
 После F5 (перезагрузка страницы) — данные загружаются из Pocketbase


Этап 6: Интеграция и тестирование
Что сделать
Прогнать полный сценарий использования. Исправить найденные проблемы. Написать документацию.
Задачи
6.1 Прогнать E2E сценарий (описан ниже)
6.2 Исправить найденные баги
6.3 Добавить обработку edge cases:
    - потеря WebSocket соединения
    - ошибки AI
    - невалидные данные
6.4 Улучшить UX где критично:
    - loading states
    - error messages
6.5 Написать README:
    - как запустить
    - как настроить LLM провайдера
    - структура проекта
6.6 Финальная проверка на чистой машине
E2E сценарий для проверки
1. docker-compose up (чистый запуск)
2. Открыть http://localhost:3000
3. Написать: "Привет"
   → AI отвечает приветствием

4. Написать: "Хочу вести список задач"
   → AI создаёт коллекцию tasks
   → В sidebar появляется группа "tasks" (пустая)
   → Приходит событие collection_created

5. Написать: "Добавь задачу: купить молоко"
   → AI создаёт запись
   → В sidebar под "tasks" появляется "купить молоко"
   → Приходит событие entity_created

6. Написать: "Добавь ещё: позвонить маме"
   → Ещё одна задача появляется

7. Написать: "Покажи все задачи"
   → AI перечисляет задачи в ответе

8. Написать: "Отметь купить молоко как выполненную"
   → AI обновляет запись
   → В sidebar видно изменение (например, статус)
   → Приходит событие entity_updated

9. Нажать F5 (перезагрузка)
   → Данные на месте
   → Чат пустой (это ок)

10. Написать: "Что я тут веду?"
    → AI отвечает что-то про задачи (из Mem0)

11. docker-compose restart backend
12. Написать: "Какие у меня задачи?"
    → AI отвечает корректно (память сохранилась)
Критерии завершения

 E2E сценарий проходит полностью
 Нет критических багов
 README позволяет запустить проект с нуля
 Проект запускается на чистой машине с Docker


Структура проекта (итоговая)
ai-workspace/
├── docker-compose.yml
├── .env.example
├── README.md
│
├── pocketbase/
│   └── pb_data/                  # volume для данных
│
├── backend/
│   ├── Dockerfile
│   ├── requirements.txt
│   └── src/
│       ├── main.py               # FastAPI app
│       ├── config.py             # настройки
│       │
│       ├── api/
│       │   ├── health.py         # health check
│       │   └── websocket.py      # WS endpoint
│       │
│       ├── services/
│       │   ├── pocketbase.py     # клиент Pocketbase
│       │   ├── memory.py         # Mem0 wrapper
│       │   └── conversation.py   # обработка сообщений
│       │
│       └── ai/
│           ├── agent.py          # PydanticAI agent
│           ├── tools.py          # tools для агента
│           ├── context.py        # AgentContext
│           └── prompts.py        # system prompts
│
└── frontend/
    ├── Dockerfile
    ├── package.json
    ├── vite.config.ts
    ├── tailwind.config.js
    └── src/
        ├── main.tsx
        ├── App.tsx
        │
        ├── hooks/
        │   └── useWorkspace.ts   # WebSocket + state
        │
        └── components/
            ├── Layout.tsx
            ├── Sidebar.tsx
            ├── EntityList.tsx
            ├── EntityGroup.tsx
            ├── EntityItem.tsx
            ├── Chat.tsx
            ├── MessageList.tsx
            ├── Message.tsx
            └── MessageInput.tsx